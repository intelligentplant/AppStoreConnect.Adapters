# App Store Connect Adapter Host: ExampleHostedAdapter

This App Store Connect adapter uses a [starter template](https://github.com/intelligentplant/AppStoreConnect.Adapters/src/DataCore.Adapter.Templates) from the [Industrial App Store](https://appstore.intelligentplant.com). The adapter is hosted by an ASP.NET Core application. You can connect an App Store Connect instance to your adapter via REST API calls, SignalR, or gRPC.


# Getting Started

The `ExampleHostedAdapter` and `ExampleHostedAdapterOptions` classes define the adapter and its runtime options respectively. You can change the names of these classes as you wish. The `ExampleHostedAdapter` class is split across three separate code files (`ExampleHostedAdapter.cs`, `ExampleHostedAdapter.TagSearch.cs`, and `ExampleHostedAdapter.ReadSnapshotTagValues.cs`) and implements tag search and real-time value polling features.

For information about how to implement adapter features, as well as example projects, please visit the [App Store Connect adapters GitHub repository](https://github.com/intelligentplant/AppStoreConnect.Adapters).

The `Startup` class configures the dependency injection container and application pipeline for the ASP.NET Core application. The `appsettings.json` file provides configuration settings for the application, including the `ExampleHostedAdapterOptions` instance that is passed to the `ExampleHostedAdapter` instance at runtime.


# Deployment

Your adapter host is an ASP.NET Core application. Microsoft's documentation about deploying and hosting ASP.NET Core applications is available [here](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy).


# Unit Tests

Helpers are available for running adapter tests in MSTest unit test projects, via the [IntelligentPlant.AppStoreConnect.Adapter.Tests.Helpers](https://www.nuget.org/packages/IntelligentPlant.AppStoreConnect.Adapter.Tests.Helpers) NuGet package.

See [here](https://github.com/intelligentplant/AppStoreConnect.Adapters/src/DataCore.Adapter.Tests.Helpers) for more information.


# Connecting App Store Connect to the Adapter

> App Store Connect must be able to validate the SSL certificate for your ASP.NET Core application. If you are using e.g. the self-signed ASP.NET Core developer certificate generated by the .NET SDK, you must install the public certificate to a Windows certificate store that is visible to the Local System identity used to run the App Store Connect service (e.g. the 'Personal' store for the local machine).

You can connect to the adapter host using REST API calls, SignalR, or gRPC. Use SignalR or gRPC if your adapter supports push functionality such as real-time value change subscriptions.


## REST API

To connect a local App Store Connect instance to your adapter using the REST API, configure a new `App Store Connect Adapter (HTTP Proxy)` data source in the App Store Connect UI, using the following settings:

- **Address:** https://localhost:44300/
- **Adapter ID:** fdb421d7-03b2-49e8-880a-224e8e5f04ef


## SignalR

To connect a local App Store Connect instance to your adapter using an ASP.NET Core SignalR proxy, configure a new `App Store Connect Adapter (SignalR Proxy)` data source in the App Store Connect UI, using the following settings:

- `Address`: https://localhost:44300/
- `Adapter ID`: fdb421d7-03b2-49e8-880a-224e8e5f04ef


## gRPC

> If you are connecting App Store Connect to a hosted adapter that uses an SSL certificate that has been issued by a certificate authority that is not listed in the [default gRPC SSL roots](https://github.com/grpc/grpc/blob/master/etc/roots.pem) (such as a self-signed certificate), you must provide App Store Connect with a copy of the certificate so that it can tell the gRPC client to accept it as valid.

To connect a local App Store Connect instance to your adapter using an ASP.NET Core gRPC proxy, configure a new `App Store Connect Adapter (gRPC Proxy)` data source in the App Store Connect UI, using the following settings:

- `Address`: https://localhost:44300/
- `Adapter ID`: fdb421d7-03b2-49e8-880a-224e8e5f04ef
- `gRPC SSL Roots`: The path in the Windows certificate store to the SSL certificate used by the adapter host. See below for details.

The value of the `gRPC SSL Roots` setting is specified using the format `CERT:\{location}\{store}\{thumbprint_or_subject}`. The placeholders used are as follows:

- `{location}` - The certificate store location. Can be either `CurrentUser` or `LocalMachine`.
- `{store}` - The name of the certificate store. Must be the name of a value from the .NET [StoreName](https://docs.microsoft.com/en-us/dotnet/api/system.security.cryptography.x509certificates.storename) enumeration.
- `{thumbprint_or_subject}` - The thumbprint or subject of the certificate to use.

Examples:

```
# Select a certificate from the Personal store for the local machine using certificate thumbprint.
CERT:\LocalMachine\My\1234567890abcdef1234567890abcdef123456789
```

```
# Select a certificate from the Personal store for the current user using subject name.
CERT:\CurrentUser\My\localhost
```
