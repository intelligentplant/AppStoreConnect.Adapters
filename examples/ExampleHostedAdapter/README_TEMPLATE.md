# App Store Connect Adapter Host: ExampleHostedAdapter

This App Store Connect adapter uses a [starter template](https://github.com/intelligentplant/AppStoreConnect.Adapters/src/DataCore.Adapter.Templates) from the [Industrial App Store](https://appstore.intelligentplant.com). The adapter is hosted by an ASP.NET Core application with a Razor Pages user interface. You can connect an App Store Connect instance to your adapter via REST API calls or SignalR.

The following client-side libraries are used in the user interface:

- [Bootstrap](https://getbootstrap.com/)
- [Font Awesome](https://fontawesome.com/)
- [jQuery](https://jquery.com/)
- [jQuery Validation](https://jqueryvalidation.org/)
- [jQuery Unobtrusive Validation](https://github.com/aspnet/jquery-validation-unobtrusive)

Client-side libraries are restored at build time via the LibMan MSBuild task. The versions of the libraries used can be found in `libman.json`.


# Getting Started

The `MyAdapter` and `MyAdapterOptions` classes define the adapter and its runtime options respectively. You can change the names of these classes as you wish. The `MyAdapter` class is split across separate code files (`MyAdapter.cs` and `MyAdapter.ReadSnapshotTagValues.cs`). The adapter implements snapshot tag value polling directly, and indirectly implements tag search and snapshot tag value subscription features via helper classes.

For information about how to implement adapter features, as well as example projects, please visit the [App Store Connect adapters GitHub repository](https://github.com/intelligentplant/AppStoreConnect.Adapters).

The `Program.cs` file configures the dependency injection container and application pipeline for the ASP.NET Core application using a minimal API application builder. The `appsettings.json` file provides configuration settings for the application. The `MyAdapterOptions` that is passed to the `MyAdapter` instance at runtime is defined in the `adaptersettings.json` file. Changes to the `adaptersettings.json` file will be automatically passed to the adapter at runtime.

The Razor Pages for the application define a basic user interface. The `Settings` page is used to configure the `MyAdapterOptions` for the adapter at runtime. Submitting the form will overwrite the contents of the `adaptersettings.json` file. Remember to extend the form when you add new properties to the `MyAdapterOptions` class!


# Deployment

Your adapter host is an ASP.NET Core application. Microsoft's documentation about deploying and hosting ASP.NET Core applications is available [here](https://docs.microsoft.com/en-us/aspnet/core/host-and-deploy).


# Unit Tests

Helpers are available for running adapter tests in MSTest unit test projects, via the [IntelligentPlant.AppStoreConnect.Adapter.Tests.Helpers](https://www.nuget.org/packages/IntelligentPlant.AppStoreConnect.Adapter.Tests.Helpers) NuGet package.

See [here](https://github.com/intelligentplant/AppStoreConnect.Adapters/src/DataCore.Adapter.Tests.Helpers) for more information.


# Connecting App Store Connect to the Adapter

> By default, App Store Connect will validate the SSL certificate for your ASP.NET Core application. If you are using a self-signed certificate such as the ASP.NET Core developer certificate generated by the .NET SDK, certificate validation will fail if the certificate has not been installed to a certificate store where it can be accessed by the App Store Connect service identity.

You can connect to the adapter host using REST API calls, SignalR, or gRPC.

> App Store Connect must be running on Windows 11/Windows Server 2022 or later to be able to connect using gRPC.


## REST API

To connect a local App Store Connect instance to your adapter using the REST API, configure a new `App Store Connect Adapter (HTTP Proxy)` data source in the App Store Connect UI, using the following settings:

- `Address`: https://localhost:44300/
- `Adapter ID`: e445a468-19ee-456c-9aac-e26288475a45
- `Use SignaR`: true

Setting the `Use SignalR` property to true allows the App Store Connect proxy to use SignalR connections for long-running subscriptions.

Note that you must disable SSL certificate verification during local development unless you have installed the ASP.NET Core development certificate to a certificate store that can be accessed by the App Store Connect service identity.


## SignalR

To connect a local App Store Connect instance to your adapter using an ASP.NET Core SignalR proxy, configure a new `App Store Connect Adapter (SignalR Proxy)` data source in the App Store Connect UI, using the following settings:

- `Address`: https://localhost:44300/
- `Adapter ID`: e445a468-19ee-456c-9aac-e26288475a45

Note that you must disable SSL certificate verification during local development unless you have installed the ASP.NET Core development certificate to a certificate store that can be accessed by the App Store Connect service identity.


## gRPC

To connect a local App Store Connect instance to your adapter using a gRPC proxy, configure a new `App Store Connect Adapter (gRPC Proxy)` data source in the App Store Connect UI, using the following settings:

- `Address`: https://localhost:44300/
- `Adapter ID`: e445a468-19ee-456c-9aac-e26288475a45

Note that you must disable SSL certificate verification during local development unless you have installed the ASP.NET Core development certificate to a certificate store that can be accessed by the App Store Connect service identity.


# Security

You should make note of the following security-related items:

- The ASP.NET Core application allows anonyous access by default. When deploying the application, it is recommended that you listen only on `localhost` and/or add authentication to the application.
- Adapter settings are not encrypted by default. If your adapter requires configuration of sensitive settings such as passwords, you should modify the application to either save the sensitive settings in a separate secure store (such as Azure Key Vault), or implement a mechanism that encrypts these settings prior to updating `adaptersettings.json` and decrypts them when reading the file from disk.

You can find a guide to adding authentication and authorization to your adapter host [here](https://github.com/intelligentplant/AppStoreConnect.Adapters/blob/main/docs/adapter-host-authn-authz.md).
