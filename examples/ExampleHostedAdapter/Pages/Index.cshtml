@page
@model ExampleHostedAdapter.Pages.IndexModel
@{
  ViewData["Title"] = "Home";
}

<div class="text-center">
  <h1 class="display-6">Adapter Overview</h1>
  <p>The current status of your <a href="https://github.com/intelligentplant/AppStoreConnect.Adapters" target="_blank" title="Visit the App Store Connect adapters repository on GitHub">App Store Connect adapter</a> is shown below.</p>
</div>

<div id="adapter-status">
@await Html.PartialAsync("~/Pages/Shared/_AdapterStatusPartial.cshtml", Model)
</div>

@section Scripts {
  <script defer>
    $(() => {
        function setLastUpdated() {
            $('#last-updated').text('Last Updated: ' + new Date().toLocaleString());
        }

        setLastUpdated();

        let updateInProgress = false;
        setInterval(function() { 
            if (updateInProgress) {
                return;
            }

            $.get({
                url: '@Url.Page("Index", "Status")',
                beforeSend: function() { 
                    updateInProgress = true;
                },
                complete: function() { 
                    updateInProgress = false;
                },
                success: function(response) {
                    $('#adapter-status').html(response);
                    setLastUpdated();
                }
            });
        }, 15000);
    });
  </script>
}