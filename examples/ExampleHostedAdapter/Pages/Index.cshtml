@page
@model ExampleHostedAdapter.Pages.IndexModel
@{
  ViewData["Title"] = "Home";
}

<div id="adapter-status">
  @await Html.PartialAsync("_AdapterStatusPartial")
</div>

@section Scripts {
  <script defer>
    $(() => {
        let updateInProgress = false;

        const setLastUpdatedTime = () => $('#last-updated').text('Last Updated: ' + new Date().toLocaleString());
        
        const updateStatus = async () => {
            if (updateInProgress) {
                return;
            }

            updateInProgress = true;
            try {
                const response = await $.get('@Url.Page("Index", "Status")');
                $('#adapter-status').html(response);
                setLastUpdatedTime();;
            }
            finally {
                updateInProgress = false;
            }
        };

        setLastUpdatedTime();
        
        setInterval(async () => { 
            await updateStatus();
        }, 15000);
    });
  </script>
}